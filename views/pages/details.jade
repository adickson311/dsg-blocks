extends ../../layouts/default

block head
  title Blocks Page

block neck
  link(rel='stylesheet', href='/views/pages/details.min.css?#{cacheBreaker}')

block feet
  //script(src='/vendor/require/require.js' data-main="vendor/dsg/main")
  script(src='/views/pages/details.js')

block body
  div.blocks-form-container
    div#header
    div#results-table
    div#categories.reveal-modal
      h1 Categories
  
  script(type='text/template', id='tmpl-header')
    div.page-header
      -if (user)
        form.form-inline.pull-right
          div.input-group
            input.form-control(name='name', type='text', placeholder='enter a name')
            input.form-control(name='pageID', type='hidden', value!='<%- id %>')
            input.form-control(name='pageName', type='hidden', value!='<%- name %>')
            button.btn.btn-primary.btn-add(type='button') Create Deal
      nav.breadcrumbs
        a(href='/') Back to pages
      h1 <%- name %>
      nav.actions
        ul
          li
            a(href!='#' data-reveal-id='categories') Edit Categories
          li
            a.page-preview(href!='/pages/<%- id %>/preview/') Preview
  
  script(type='text/template', id='tmpl-results-table')
    table.table.table-striped
      thead
        tr
          th.col-sm-3 Deal Name
          th.col-sm-3 Headline
          th.col-sm-4 Link
          -if (user)
            th.col-sm-1
      tbody#results-rows
  
  script(type='text/template', id='tmpl-results-row')
    td.stretch
      a(href!='/deals/<%- _id %>/') <%- name %>
    td.stretch 
      <%- headline %>
    td.nowrap
      div <%- link %>
    -if (user)
      td
        input.btn.btn-default.btn-sm.btn-details(type='button', value='Edit')
  
  script(type='text/template', id='tmpl-results-empty-row')
    tr
      td(colspan='4') no documents matched
  
  script(type='text/template', id='data-record') !{data.record}

  script(type='text/template', id='data-deals') !{data.deals}
  
  script(type='text/template', id='tmpl-category-form')
    form.form-inline.pull-right
      div.alerts
        |<% _.each(errors, function(err) { %>
        div.alert.alert-danger.alert-dismissable
          button.close(type='button', data-dismiss='alert') &times;
          |<%= err %>
        |<% }); %>
        |<% if (success) { %>
        div.alert.alert-info.alert-dismissable
          button.close(type='button', data-dismiss='alert') &times;
          | Changes have been saved.
        |<% } %>
      div.row
        div.col-sm-6
          div.control-group(class!='<%= errfor.name ? "has-error" : "" %>')
            label.control-label Name:
            input.form-control(type='text', name='name', value!='<%= name %>')
            span.help-block <%= errfor.name %>
        div.col-sm-6
          div.control-group(class!='<%= errfor.dealID ? "has-error" : "" %>')
            label.control-label Deal ID:
            input.form-control(type='text', name='dealID', value!='')
            span.help-block <%= errfor.dealID %>
      div.row
        div.col-sm-12
          div.control-group
            button.btn.btn-primary.btn-update(type='button') Update